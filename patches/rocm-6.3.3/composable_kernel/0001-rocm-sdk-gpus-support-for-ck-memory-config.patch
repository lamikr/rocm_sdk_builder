From 95e22fe5a11f3dd7ab2f06cf519acde0a29a2586 Mon Sep 17 00:00:00 2001
From: Mika Laitio <lamikr@gmail.com>
Date: Sat, 15 Mar 2025 21:23:55 -0700
Subject: [PATCH 1/5] rocm sdk gpus support for ck memory config

Signed-off-by: Mika Laitio <lamikr@gmail.com>
---
 include/ck/ck.hpp                       | 12 +++++++++---
 include/ck/host_utility/device_prop.hpp | 19 ++++++++++++++++++-
 include/ck_tile/core/config.hpp         |  3 ++-
 3 files changed, 29 insertions(+), 5 deletions(-)

diff --git a/include/ck/ck.hpp b/include/ck/ck.hpp
index 5f74d51a6..d33e67ce7 100644
--- a/include/ck/ck.hpp
+++ b/include/ck/ck.hpp
@@ -66,7 +66,8 @@ CK_DECLARE_ENV_VAR_BOOL(CK_LOGGING)
     defined(__gfx1034__) || defined(__gfx1035__) || defined(__gfx1036__)
 #define __gfx103__
 #endif
-#if defined(__gfx1100__) || defined(__gfx1101__) || defined(__gfx1102__) || defined(__gfx1103__)
+#if defined(__gfx1100__) || defined(__gfx1101__) || defined(__gfx1102__) || defined(__gfx1103__) || \
+    defined(__gfx1150__) || defined(__gfx1151__)
 #define __gfx11__
 #endif
 #if defined(__gfx1200__) || defined(__gfx1201__)
@@ -76,14 +77,19 @@ CK_DECLARE_ENV_VAR_BOOL(CK_LOGGING)
 // buffer resource
 #ifndef __HIP_DEVICE_COMPILE__ // for host code
 #define CK_BUFFER_RESOURCE_3RD_DWORD -1
-#elif defined(__gfx803__) || defined(__gfx900__) || defined(__gfx906__) || defined(__gfx9__)
+#elif defined(__gfx803__) || defined(__gfx900__) || defined(__gfx902__) || defined(__gfx906__) || defined(__gfx908__) || \
+      defined(__gfx90a__) || defined(__gfx940__) || defined(__gfx941__) ||                   \
+      defined(__gfx942__) || defined(__gfx9__)  // test device
 #define CK_BUFFER_RESOURCE_3RD_DWORD 0x00020000
-#elif defined(__gfx103__)
+#elif defined(__gfx101__) || defined(__gfx103__)
 #define CK_BUFFER_RESOURCE_3RD_DWORD 0x31014000
 #elif defined(__gfx11__) || defined(__gfx12__)
 #define CK_BUFFER_RESOURCE_3RD_DWORD 0x31004000
 #endif
 
+// TODO: rdna1/gfx1010 has CK_USE_AMD_V_FMAC_F32 but not CK_USE_AMD_V_DOT2_F32_F16 CK_USE_AMD_V_DOT4_I32_I8
+// TODO: check defined(__gfx1035__)
+
 // FMA instruction
 #ifndef __HIP_DEVICE_COMPILE__                   // for host code, define nothing
 #elif defined(__gfx803__) || defined(__gfx900__) // for GPU code
diff --git a/include/ck/host_utility/device_prop.hpp b/include/ck/host_utility/device_prop.hpp
index f5c4b43ad..b816fdccd 100644
--- a/include/ck/host_utility/device_prop.hpp
+++ b/include/ck/host_utility/device_prop.hpp
@@ -40,7 +40,23 @@ inline std::string get_device_name()
         {"gfx804", "gfx803"},
         {"Vega10", "gfx900"},
         {"gfx901", "gfx900"},
+        {"navi10", "gfx1010"},
+        {"navi12", "gfx1011"},
+        {"navi14", "gfx1012"},
         {"10.3.0 Sienna_Cichlid 18", "gfx1030"},
+        {"navi22", "gfx1031"},
+        {"navi23", "gfx1032"},
+        {"navi24", "gfx1034"},
+        {"rembrandt", "gfx1035"},
+        {"raphael", "gfx1036"},
+        {"navi31", "gfx1100"},
+        {"navi32", "gfx1101"},
+        {"navi33", "gfx1102"},
+        {"phoenix", "gfx1103"},
+        {"strixpoint", "gfx1150"},
+        {"strixhalo", "gfx1151"},
+        {"gfx1200", "gfx1200"},
+        {"gfx1201", "gfx1201"},
     };
 
     const auto name = raw_name.substr(0, raw_name.find(':')); // str.substr(0, npos) returns str.
@@ -87,7 +103,8 @@ inline bool is_gfx103_supported()
 inline bool is_gfx11_supported()
 {
     return ck::get_device_name() == "gfx1100" || ck::get_device_name() == "gfx1101" ||
-           ck::get_device_name() == "gfx1102" || ck::get_device_name() == "gfx1103";
+           ck::get_device_name() == "gfx1102" || ck::get_device_name() == "gfx1103" ||
+           ck::get_device_name() == "gfx1150" || ck::get_device_name() == "gfx1151";
 }
 
 inline bool is_gfx12_supported()
diff --git a/include/ck_tile/core/config.hpp b/include/ck_tile/core/config.hpp
index a8bc27cdf..d25e73d0c 100644
--- a/include/ck_tile/core/config.hpp
+++ b/include/ck_tile/core/config.hpp
@@ -14,7 +14,8 @@
     defined(__gfx1034__) || defined(__gfx1035__) || defined(__gfx1036__)
 #define __gfx103__
 #endif
-#if defined(__gfx1100__) || defined(__gfx1101__) || defined(__gfx1102__) || defined(__gfx1103__)
+#if defined(__gfx1100__) || defined(__gfx1101__) || defined(__gfx1102__) || defined(__gfx1103__) || \
+    defined(__gfx1150__) || defined(__gfx1151__)
 #define __gfx11__
 #endif
 #if defined(__gfx1200__) || defined(__gfx1201__)
-- 
2.41.3

