From fd99ae49a9ac236dda338361ff6946ec33f10720 Mon Sep 17 00:00:00 2001
From: Mika Laitio <lamikr@gmail.com>
Date: Fri, 21 Mar 2025 10:07:44 -0700
Subject: [PATCH 1/8] add rocm sdk builder gpus

Signed-off-by: Mika Laitio <lamikr@gmail.com>
---
 include/aotriton/util.h | 18 ++++++++++
 v2python/compile.py     | 22 ++++++++++++
 v2python/gpu_targets.py | 78 ++++++++++++++++++++++++++++++++++++++++-
 v2python/tuning_lut.py  | 56 ++++++++++++++++++++++++++---
 v2src/util.cc           | 18 ++++++++++
 5 files changed, 186 insertions(+), 6 deletions(-)

diff --git a/include/aotriton/util.h b/include/aotriton/util.h
index e1a6656..153fac2 100644
--- a/include/aotriton/util.h
+++ b/include/aotriton/util.h
@@ -36,11 +36,29 @@ enum GpuVendor : uint32_t {
 // More bits for potential non-PCI architectures
 enum GpuArch : uint64_t {
   GPU_ARCH_UNKNOWN = 0,
+  GPU_ARCH_AMD_GFX900 = CAT(GpuVendor::kAMD, 0x900),
+  GPU_ARCH_AMD_GFX902 = CAT(GpuVendor::kAMD, 0x902),
+  GPU_ARCH_AMD_GFX906 = CAT(GpuVendor::kAMD, 0x906),
+  GPU_ARCH_AMD_GFX908 = CAT(GpuVendor::kAMD, 0x908),
   GPU_ARCH_AMD_GFX90A = CAT(GpuVendor::kAMD, 0x90a),
   GPU_ARCH_AMD_GFX942 = CAT(GpuVendor::kAMD, 0x942),
+  GPU_ARCH_AMD_GFX1010 = CAT(GpuVendor::kAMD, 0x1010),
+  GPU_ARCH_AMD_GFX1011 = CAT(GpuVendor::kAMD, 0x1011),
+  GPU_ARCH_AMD_GFX1012 = CAT(GpuVendor::kAMD, 0x1012),
+  GPU_ARCH_AMD_GFX1030 = CAT(GpuVendor::kAMD, 0x1030),
+  GPU_ARCH_AMD_GFX1031 = CAT(GpuVendor::kAMD, 0x1031),
+  GPU_ARCH_AMD_GFX1032 = CAT(GpuVendor::kAMD, 0x1032),
+  GPU_ARCH_AMD_GFX1034 = CAT(GpuVendor::kAMD, 0x1034),
+  GPU_ARCH_AMD_GFX1035 = CAT(GpuVendor::kAMD, 0x1035),
+  GPU_ARCH_AMD_GFX1036 = CAT(GpuVendor::kAMD, 0x1036),
   GPU_ARCH_AMD_GFX1100 = CAT(GpuVendor::kAMD, 0x1100),
   GPU_ARCH_AMD_GFX1101 = CAT(GpuVendor::kAMD, 0x1101),
+  GPU_ARCH_AMD_GFX1102 = CAT(GpuVendor::kAMD, 0x1102),
+  GPU_ARCH_AMD_GFX1103 = CAT(GpuVendor::kAMD, 0x1103),
+  GPU_ARCH_AMD_GFX1150 = CAT(GpuVendor::kAMD, 0x1150),
+  GPU_ARCH_AMD_GFX1151 = CAT(GpuVendor::kAMD, 0x1151),
   GPU_ARCH_AMD_GFX950 = CAT(GpuVendor::kAMD, 0x950),
+  GPU_ARCH_AMD_GFX1200 = CAT(GpuVendor::kAMD, 0x1200),
   GPU_ARCH_AMD_GFX1201 = CAT(GpuVendor::kAMD, 0x1201),
 };
 
diff --git a/v2python/compile.py b/v2python/compile.py
index b41f0c3..f5ca992 100644
--- a/v2python/compile.py
+++ b/v2python/compile.py
@@ -22,6 +22,28 @@ KNOWN_TARGETS = {
         'Navi32' : GPUTarget('hip', 'gfx1101', 32),
         'Unidentified' : GPUTarget('hip', 'gfx950', 64),
         'RX9070XT' : GPUTarget('hip', 'gfx1201', 32),
+        'gfx900' : GPUTarget('hip', 'gfx900', 32),
+        'gfx902' : GPUTarget('hip', 'gfx902', 32),
+        'gfx906' : GPUTarget('hip', 'gfx906', 64),
+        'gfx908' : GPUTarget('hip', 'gfx908', 64),
+        'gfx90a' : GPUTarget('hip', 'gfx90a', 64),
+        'gfx942' : GPUTarget('hip', 'gfx942', 64),
+        'gfx1010' : GPUTarget('hip', 'gfx1010', 32),
+        'gfx1011' : GPUTarget('hip', 'gfx1011', 32),
+        'gfx1012' : GPUTarget('hip', 'gfx1012', 32),
+        'gfx1030' : GPUTarget('hip', 'gfx1030', 32),
+        'gfx1031' : GPUTarget('hip', 'gfx1031', 32),
+        'gfx1032' : GPUTarget('hip', 'gfx1032', 32),
+        'gfx1035' : GPUTarget('hip', 'gfx1035', 32),
+        'gfx1036' : GPUTarget('hip', 'gfx1036', 32),
+        'gfx1100' : GPUTarget('hip', 'gfx1100', 32),
+        'gfx1101' : GPUTarget('hip', 'gfx1101', 32),
+        'gfx1102' : GPUTarget('hip', 'gfx1102', 32),
+        'gfx1103' : GPUTarget('hip', 'gfx1103', 32),
+        'gfx1150' : GPUTarget('hip', 'gfx1150', 32),
+        'gfx1151' : GPUTarget('hip', 'gfx1151', 32),
+        'gfx1200' : GPUTarget('hip', 'gfx1200', 32),
+        'gfx1201' : GPUTarget('hip', 'gfx1201', 32),
 }
 
 desc = """
diff --git a/v2python/gpu_targets.py b/v2python/gpu_targets.py
index 6342be0..f5df9df 100644
--- a/v2python/gpu_targets.py
+++ b/v2python/gpu_targets.py
@@ -8,6 +8,29 @@ AOTRITON_SUPPORTED_GPUS = {
     'Navi32'    : 'GPU_ARCH_AMD_GFX1101',
     'Unidentified'    : 'GPU_ARCH_AMD_GFX950',
     'RX9070XT'  : 'GPU_ARCH_AMD_GFX1201',
+    'gfx900'    : 'GPU_ARCH_AMD_GFX900',
+    'gfx902'    : 'GPU_ARCH_AMD_GFX902',
+    'gfx906'    : 'GPU_ARCH_AMD_GFX906',
+    'gfx908'    : 'GPU_ARCH_AMD_GFX908',
+    'gfx90a'    : 'GPU_ARCH_AMD_GFX90A',
+    'gfx942'    : 'GPU_ARCH_AMD_GFX942',
+    'gfx1010'   : 'GPU_ARCH_AMD_GFX1010',
+    'gfx1011'   : 'GPU_ARCH_AMD_GFX1011',
+    'gfx1012'   : 'GPU_ARCH_AMD_GFX1012',
+    'gfx1030'   : 'GPU_ARCH_AMD_GFX1030',
+    'gfx1031'   : 'GPU_ARCH_AMD_GFX1031',
+    'gfx1032'   : 'GPU_ARCH_AMD_GFX1032',
+    'gfx1034'   : 'GPU_ARCH_AMD_GFX1034',
+    'gfx1035'   : 'GPU_ARCH_AMD_GFX1035',
+    'gfx1036'   : 'GPU_ARCH_AMD_GFX1036',
+    'gfx1100'   : 'GPU_ARCH_AMD_GFX1100',
+    'gfx1101'   : 'GPU_ARCH_AMD_GFX1101',
+    'gfx1102'   : 'GPU_ARCH_AMD_GFX1102',
+    'gfx1103'   : 'GPU_ARCH_AMD_GFX1103',
+    'gfx1150'   : 'GPU_ARCH_AMD_GFX1150',
+    'gfx1151'   : 'GPU_ARCH_AMD_GFX1151',
+    'gfx1200'   : 'GPU_ARCH_AMD_GFX1200',
+    'gfx1201'   : 'GPU_ARCH_AMD_GFX1201',
 }
 
 AOTRITON_GPU_ARCH_TUNING_STRING = {
@@ -17,11 +40,41 @@ AOTRITON_GPU_ARCH_TUNING_STRING = {
     'Navi32'    : 'gfx1101',
     'Unidentified'    : 'gfx950',
     'RX9070XT'  : 'gfx1201',
+    'gfx900'    : 'gfx900',
+    'gfx902'    : 'gfx902',
+    'gfx906'    : 'gfx906',
+    'gfx908'    : 'gfx908',
+    'gfx90a'    : 'gfx90a',
+    'gfx942'    : 'gfx942',
+    'gfx1010'   : 'gfx1010',
+    'gfx1011'   : 'gfx1011',
+    'gfx1012'   : 'gfx1012',
+    'gfx1030'   : 'gfx1030',
+    'gfx1031'   : 'gfx1031',
+    'gfx1032'   : 'gfx1032',
+    'gfx1034'   : 'gfx1034',
+    'gfx1035'   : 'gfx1035',
+    'gfx1036'   : 'gfx1036',
+    'gfx1100'   : 'gfx1100',
+    'gfx1101'   : 'gfx1101',
+    'gfx1102'   : 'gfx1102',
+    'gfx1103'   : 'gfx1103',
+    'gfx1150'   : 'gfx1150',
+    'gfx1151'   : 'gfx1151',
+    'gfx1200'   : 'gfx1200',
+    'gfx1201'   : 'gfx1201',
 }
 
 AOTRITON_TUNING_DATABASE_REUSE = {
-    'gfx950' : 'gfx942',
+    'gfx950'  : 'gfx942',
+    'gfx1200' : 'gfx1100',
     'gfx1201' : 'gfx1100',
+    'gfx1100' : 'gfx1100',
+    'gfx1101' : 'gfx1100',
+    'gfx1102' : 'gfx1100',
+    'gfx1103' : 'gfx1100',
+    'gfx1150' : 'gfx1100',
+    'gfx1151' : 'gfx1100',
 }
 
 AOTRITON_GPU_WARPSIZE = {
@@ -31,4 +84,27 @@ AOTRITON_GPU_WARPSIZE = {
     'Navi32'    : 32,
     'Unidentified'    : 64,
     'RX9070XT'  : 32,
+    'gfx900'    : 32,
+    'gfx902'    : 32,
+    'gfx906'    : 64,
+    'gfx908'    : 64,
+    'gfx90a'    : 64,
+    'gfx942'    : 64,
+    'gfx1010'   : 32,
+    'gfx1011'   : 32,
+    'gfx1012'   : 32,
+    'gfx1030'   : 32,
+    'gfx1031'   : 32,
+    'gfx1032'   : 32,
+    'gfx1034'   : 32,
+    'gfx1035'   : 32,
+    'gfx1036'   : 32,
+    'gfx1100'   : 32,
+    'gfx1101'   : 32,
+    'gfx1102'   : 32,
+    'gfx1103'   : 32,
+    'gfx1150'   : 32,
+    'gfx1151'   : 32,
+    'gfx1200'   : 32,
+    'gfx1201'   : 32,
 }
diff --git a/v2python/tuning_lut.py b/v2python/tuning_lut.py
index 899ad79..0e9c4b5 100644
--- a/v2python/tuning_lut.py
+++ b/v2python/tuning_lut.py
@@ -13,12 +13,35 @@ import os
 SKIPPED_LUT_CHECK = os.getenv('AOTRITON_SKIP_LUT_CHECK', default='').split(',')
 
 GPU_TO_DIRECTORY = {
-    'MI200'  : 'amd-gfx90a',
-    'MI300X' : 'amd-gfx942',
-    'Navi31' : 'amd-gfx110x',
-    'Navi32' : 'amd-gfx110x',
+    'MI200'   : 'amd-gfx90a',
+    'MI300X'  : 'amd-gfx942',
+    'Navi31'  : 'amd-gfx110x',
+    'Navi32'  : 'amd-gfx110x',
     'Unidentified' : 'amd-gfx950',
-    'RX9070XT'    : 'amd-gfx120x',
+    'RX9070XT' : 'amd-gfx120x',
+    'gfx900'  : 'amd-gfx900',
+    'gfx902'  : 'amd-gfx902',
+    'gfx906'  : 'amd-gfx906',
+    'gfx908'  : 'amd-gfx908',
+    'gfx90a'  : 'amd-gfx90a',
+    'gfx942'  : 'amd-gfx942',
+    'gfx1010' : 'amd-gfx1010',
+    'gfx1011' : 'amd-gfx1011',
+    'gfx1012' : 'amd-gfx1012',
+    'gfx1030' : 'amd-gfx1030',
+    'gfx1031' : 'amd-gfx1031',
+    'gfx1032' : 'amd-gfx1032',
+    'gfx1034' : 'amd-gfx1034',
+    'gfx1035' : 'amd-gfx1035',
+    'gfx1036' : 'amd-gfx1036',
+    'gfx1100' : 'amd-gfx1100',
+    'gfx1101' : 'amd-gfx1101',
+    'gfx1102' : 'amd-gfx1102',
+    'gfx1103' : 'amd-gfx1103',
+    'gfx1150' : 'amd-gfx1150',
+    'gfx1151' : 'amd-gfx1151',
+    'gfx1200' : 'amd-gfx1200',
+    'gfx1201' : 'amd-gfx1201',
 }
 
 GPU_TO_CLUSTER_SUFFIX = {
@@ -28,6 +51,29 @@ GPU_TO_CLUSTER_SUFFIX = {
     'Navi32' : 'Navi3x',
     'Unidentified'      : 'Unidentified',
     'RX9070XT'    : 'RX9070XT',
+    'gfx900'  : 'gfx900',
+    'gfx902'  : 'gfx902',
+    'gfx906'  : 'gfx906',
+    'gfx908'  : 'gfx908',
+    'gfx90a'  : 'gfx90a',
+    'gfx942'  : 'gfx942',
+    'gfx1010' : 'gfx1010',
+    'gfx1011' : 'gfx1011',
+    'gfx1012' : 'gfx1012',
+    'gfx1030' : 'gfx1030',
+    'gfx1031' : 'gfx1031',
+    'gfx1032' : 'gfx1032',
+    'gfx1034' : 'gfx1034',
+    'gfx1035' : 'gfx1035',
+    'gfx1036' : 'gfx1036',
+    'gfx1100' : 'gfx1100',
+    'gfx1101' : 'gfx1101',
+    'gfx1102' : 'gfx1102',
+    'gfx1103' : 'gfx1103',
+    'gfx1150' : 'gfx1150',
+    'gfx1151' : 'gfx1151',
+    'gfx1200' : 'gfx1200',
+    'gfx1201' : 'gfx1201',
 }
 
 class MissingLutEntry(Exception):
diff --git a/v2src/util.cc b/v2src/util.cc
index d08054c..6138125 100644
--- a/v2src/util.cc
+++ b/v2src/util.cc
@@ -39,11 +39,29 @@ private:
 };
 
 std::unordered_map<std::string, GpuArch> LazyArch::string_to_arch = {
+  {"gfx900", GPU_ARCH_AMD_GFX900},
+  {"gfx902", GPU_ARCH_AMD_GFX902},
+  {"gfx906", GPU_ARCH_AMD_GFX906},
+  {"gfx908", GPU_ARCH_AMD_GFX908},
   {"gfx90a", GPU_ARCH_AMD_GFX90A},
   {"gfx942", GPU_ARCH_AMD_GFX942},
+  {"gfx1010", GPU_ARCH_AMD_GFX1010},
+  {"gfx1011", GPU_ARCH_AMD_GFX1011},
+  {"gfx1012", GPU_ARCH_AMD_GFX1012},
+  {"gfx1030", GPU_ARCH_AMD_GFX1030},
+  {"gfx1031", GPU_ARCH_AMD_GFX1031},
+  {"gfx1032", GPU_ARCH_AMD_GFX1032},
+  {"gfx1034", GPU_ARCH_AMD_GFX1034},
+  {"gfx1035", GPU_ARCH_AMD_GFX1035},
+  {"gfx1036", GPU_ARCH_AMD_GFX1036},
   {"gfx1100", GPU_ARCH_AMD_GFX1100},
   {"gfx1101", GPU_ARCH_AMD_GFX1101},
+  {"gfx1102", GPU_ARCH_AMD_GFX1102},
+  {"gfx1103", GPU_ARCH_AMD_GFX1103},
+  {"gfx1150", GPU_ARCH_AMD_GFX1150},
+  {"gfx1151", GPU_ARCH_AMD_GFX1151},
   {"gfx950", GPU_ARCH_AMD_GFX950},
+  {"gfx1200", GPU_ARCH_AMD_GFX1200},
   {"gfx1201", GPU_ARCH_AMD_GFX1201},
 };
 
-- 
2.48.1

