From 45201c3ea05ef90dc06f1d2c9796237584576f4c Mon Sep 17 00:00:00 2001
From: Mika Laitio <lamikr@gmail.com>
Date: Mon, 17 Mar 2025 16:48:52 -0700
Subject: [PATCH 9/9] gfx1200 and gfx1201

Signed-off-by: Mika Laitio <lamikr@gmail.com>
---
 include/aotriton/util.h                                     | 2 ++
 .../third_party/amd/backend/include/hsa/amd_hsa_elf.h       | 3 +++
 v2python/compile.py                                         | 2 ++
 v2python/gpu_targets.py                                     | 6 ++++++
 v2src/util.cc                                               | 2 ++
 5 files changed, 15 insertions(+)

diff --git a/include/aotriton/util.h b/include/aotriton/util.h
index 4aac6d9..782b57a 100644
--- a/include/aotriton/util.h
+++ b/include/aotriton/util.h
@@ -55,6 +55,8 @@ enum GpuArch : uint64_t {
   GPU_ARCH_AMD_GFX1103 = CAT(GpuVendor::kAMD, 0x1103),
   GPU_ARCH_AMD_GFX1150 = CAT(GpuVendor::kAMD, 0x1150),
   GPU_ARCH_AMD_GFX1151 = CAT(GpuVendor::kAMD, 0x1151),
+  GPU_ARCH_AMD_GFX1200 = CAT(GpuVendor::kAMD, 0x1200),
+  GPU_ARCH_AMD_GFX1201 = CAT(GpuVendor::kAMD, 0x1201),
 };
 
 template<int Rank>
diff --git a/third_party/triton/third_party/amd/backend/include/hsa/amd_hsa_elf.h b/third_party/triton/third_party/amd/backend/include/hsa/amd_hsa_elf.h
index 51aa389..962edf4 100644
--- a/third_party/triton/third_party/amd/backend/include/hsa/amd_hsa_elf.h
+++ b/third_party/triton/third_party/amd/backend/include/hsa/amd_hsa_elf.h
@@ -127,9 +127,12 @@ enum : unsigned {
   EF_AMDGPU_MACH_AMDGCN_GFX1036       = 0x045,
   EF_AMDGPU_MACH_AMDGCN_GFX1101       = 0x046,
   EF_AMDGPU_MACH_AMDGCN_GFX1102       = 0x047,
+  EF_AMDGPU_MACH_AMDGCN_GFX1200       = 0x048,
   EF_AMDGPU_MACH_AMDGCN_GFX1151       = 0x04a,
   EF_AMDGPU_MACH_AMDGCN_GFX941        = 0x04b,
   EF_AMDGPU_MACH_AMDGCN_GFX942        = 0x04c,
+  EF_AMDGPU_MACH_AMDGCN_RESERVED_0X4D = 0x04d,
+  EF_AMDGPU_MACH_AMDGCN_GFX1201       = 0x04e,
 
   // First/last AMDGCN-based processors.
   EF_AMDGPU_MACH_AMDGCN_FIRST = EF_AMDGPU_MACH_AMDGCN_GFX600,
diff --git a/v2python/compile.py b/v2python/compile.py
index a5d0360..7ff9e6a 100644
--- a/v2python/compile.py
+++ b/v2python/compile.py
@@ -40,6 +40,8 @@ KNOWN_TARGETS = {
         'gfx1103' : GPUTarget('hip', 'gfx1103', 32),
         'gfx1150' : GPUTarget('hip', 'gfx1150', 32),
         'gfx1151' : GPUTarget('hip', 'gfx1151', 32),
+        'gfx1200' : GPUTarget('hip', 'gfx1200', 32),
+        'gfx1201' : GPUTarget('hip', 'gfx1201', 32),
 }
 
 desc = """
diff --git a/v2python/gpu_targets.py b/v2python/gpu_targets.py
index a588b63..f75311e 100644
--- a/v2python/gpu_targets.py
+++ b/v2python/gpu_targets.py
@@ -26,6 +26,8 @@ AOTRITON_SUPPORTED_GPUS = {
     'gfx1103'   : 'GPU_ARCH_AMD_GFX1103',
     'gfx1150'   : 'GPU_ARCH_AMD_GFX1150',
     'gfx1151'   : 'GPU_ARCH_AMD_GFX1151',
+    'gfx1200'   : 'GPU_ARCH_AMD_GFX1200',
+    'gfx1201'   : 'GPU_ARCH_AMD_GFX1201',
 }
 
 AOTRITON_GPU_ARCH_TUNING_STRING = {
@@ -53,6 +55,8 @@ AOTRITON_GPU_ARCH_TUNING_STRING = {
     'gfx1103'   : 'gfx1103',
     'gfx1150'   : 'gfx1150',
     'gfx1151'   : 'gfx1151',
+    'gfx1200'   : 'gfx1200',
+    'gfx1201'   : 'gfx1201',
 }
 
 AOTRITON_GPU_WARPSIZE = {
@@ -80,4 +84,6 @@ AOTRITON_GPU_WARPSIZE = {
     'gfx1103'   : 32,
     'gfx1150'   : 32,
     'gfx1151'   : 32,
+    'gfx1200'   : 32,
+    'gfx1201'   : 32,
 }
diff --git a/v2src/util.cc b/v2src/util.cc
index e54614a..db8671b 100644
--- a/v2src/util.cc
+++ b/v2src/util.cc
@@ -52,6 +52,8 @@ std::unordered_map<std::string, GpuArch> LazyArch::string_to_arch = {
   {"gfx1103", GPU_ARCH_AMD_GFX1103},
   {"gfx1150", GPU_ARCH_AMD_GFX1150},
   {"gfx1151", GPU_ARCH_AMD_GFX1151},
+  {"gfx1200", GPU_ARCH_AMD_GFX1200},
+  {"gfx1201", GPU_ARCH_AMD_GFX1201},
 };
 
 GpuArch
-- 
2.48.1

