From 8d6d3e5ee245ad610f589cb36ad8aefe817f88bd Mon Sep 17 00:00:00 2001
From: Mika Laitio <lamikr@gmail.com>
Date: Sat, 22 Mar 2025 10:19:07 -0700
Subject: [PATCH 2/3] add gcn5 architecture check

Signed-off-by: Mika Laitio <lamikr@gmail.com>
---
 third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h | 1 +
 third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp   | 5 +++++
 2 files changed, 6 insertions(+)

diff --git a/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h b/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h
index 223eadb2e..f1c237e42 100644
--- a/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h
+++ b/third_party/amd/include/TritonAMDGPUToLLVM/TargetUtils.h
@@ -8,6 +8,7 @@ namespace mlir::triton::AMD {
 // A list of ISA families we care about.
 enum class ISAFamily {
   Unknown,
+  GCN5,
   CDNA1,
   CDNA2,
   CDNA3,
diff --git a/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp b/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp
index fb655694e..78656518c 100644
--- a/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp
+++ b/third_party/amd/lib/TritonAMDGPUToLLVM/TargetUtils.cpp
@@ -19,6 +19,11 @@ ISAFamily deduceISAFamily(llvm::StringRef arch) {
     return ISAFamily::CDNA2;
   case llvm::AMDGPU::GK_GFX908:
     return ISAFamily::CDNA1;
+  case llvm::AMDGPU::GK_GFX900:
+  case llvm::AMDGPU::GK_GFX902:
+  case llvm::AMDGPU::GK_GFX906:
+    return ISAFamily::GCN5;
+
   default:
     break;
   }
-- 
2.41.3

